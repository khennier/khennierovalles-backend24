<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{title}}</title>
    <link rel="stylesheet" href="/src/public/styles.css">
</head>
<body>
    <div class="container">
        <h1>{{title}}</h1>

        <!-- Formulario para añadir un producto con imágenes -->
        <form action="/realtimeproducts" method="POST" enctype="multipart/form-data">
            <div class="form-group">
                <label for="title">Título:</label>
                <input type="text" id="title" name="title" required>
            </div>
            <div class="form-group">
                <label for="description">Descripción:</label>
                <textarea id="description" name="description" required></textarea>
            </div>
            <div class="form-group">
                <label for="code">Código:</label>
                <input type="text" id="code" name="code" required>
            </div>
            <div class="form-group">
                <label for="price">Precio:</label>
                <input type="number" id="price" name="price" required>
            </div>
            <div class="form-group">
                <label for="stock">Stock:</label>
                <input type="number" id="stock" name="stock" required>
            </div>
            <div class="form-group">
                <label for="category">Categoría:</label>
                <input type="text" id="category" name="category" required>
            </div>
            <div class="form-group">
                <label for="thumbnails">Imágenes del Producto:</label>
                <input type="file" id="thumbnails" name="thumbnails" accept="image/*" multiple required>
            </div>
            <button type="submit">Añadir Producto</button>
        </form>

        <!-- Mostrar productos en formato "cards" -->
        <h2>Productos Actuales:</h2>
        <div class="product-grid">
            {{#each products}}
            <div class="product-card">
                {{#each thumbnails}}
                <img src="{{this}}" alt="{{../title}}">
                {{/each}}
                <h3>{{title}}</h3>
                <p>{{description}}</p>
                <p>Precio: ${{price}}</p>

                <!-- Botones de Modificar y Borrar -->
                <button class="button" onclick="fillUpdateForm('{{this._id}}', '{{this.title}}', '{{this.description}}', '{{this.code}}', {{this.price}}, {{this.stock}}, '{{this.category}}')">Modificar</button>
                <button class="clear-button" onclick="deleteProduct('{{this._id}}')">Borrar</button>
            </div>
            {{/each}}
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const socket = io();

            socket.on('updateProducts', (product) => {
                const productList = document.getElementById('product-list');
                let productItem = document.querySelector(`li[data-id='${product._id}']`);
                if (productItem) {
                    productItem.innerHTML = `
                        <div class="product-info">
                            <div class="product-title">${product.title}</div>
                            <div class="product-price">$${product.price}</div>
                            <div class="product-details">${product.description}</div>
                            <div class="product-meta">Code: ${product.code} | Status: ${product.status ? 'Available' : 'Out of Stock'} | Stock: ${product.stock} | Category: ${product.category}</div>
                        </div>
                        <button class="button" onclick="fillUpdateForm('${product._id}', '${product.title}', '${product.description}', '${product.code}', ${product.price}, ${product.stock}, '${product.category}')">Modificar</button>
                        <button class="clear-button" onclick="deleteProduct('${product._id}')">Borrar</button>
                    `;
                } else {
                    const newProduct = document.createElement('li');
                    newProduct.dataset.id = product._id;
                    newProduct.innerHTML = `
                        <div class="product-info">
                            <div class="product-title">${product.title}</div>
                            <div class="product-price">$${product.price}</div>
                            <div class="product-details">${product.description}</div>
                            <div class="product-meta">Code: ${product.code} | Status: ${product.status ? 'Available' : 'Out of Stock'} | Stock: ${product.stock} | Category: ${product.category}</div>
                        </div>
                        <button class="button" onclick="fillUpdateForm('${product._id}', '${product.title}', '${product.description}', '${product.code}', ${product.price}, ${product.stock}, '${product.category}')">Modificar</button>
                        <button class="clear-button" onclick="deleteProduct('${product._id}')">Borrar</button>
                    `;
                    productList.appendChild(newProduct);
                }
            });

            socket.on('removeProduct', (productId) => {
                const productList = document.getElementById('product-list');
                const productToRemove = document.querySelector(`li[data-id='${productId}']`);
                if (productToRemove) {
                    productList.removeChild(productToRemove);
                }
            });

            window.fillUpdateForm = (id, title, description, code, price, stock, category) => {
                document.getElementById('update-id').value = id;
                document.getElementById('update-title').value = title;
                document.getElementById('update-description').value = description;
                document.getElementById('update-code').value = code;
                document.getElementById('update-price').value = price;
                document.getElementById('update-stock').value = stock;
                document.getElementById('update-category').value = category;
                document.getElementById('update-form').style.display = 'block';
            }

            window.deleteProduct = (id) => {
                socket.emit('deleteProduct', id);
            };
        });
    </script>
</body>
</html>
